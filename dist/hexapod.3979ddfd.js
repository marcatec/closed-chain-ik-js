var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},o={},n=e.parcelRequireafd0;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in o){var n=o[e];delete o[e];var i={id:e,exports:{}};return t[e]=i,n.call(i.exports,i,i.exports),i.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){o[e]=t},e.parcelRequireafd0=n);var i=n("ilwiq"),a=n("5Rd1x"),s=n("fUhpq"),r=n("jiuw3"),d=n("7MGRS"),l=n("4CEV9"),p=n("8C12l"),c=n("Q6arU"),w=n("aXdpk");const h={animate:"gyrate",baseTilt:0,solve:!0,displayMesh:!0,displayIk:!1,enableControls:!0,settleIterations:6,displayConvergedOnly:!0},u={maxIterations:10,divergeThreshold:.05,stallThreshold:1e-5,translationErrorClamp:.01,rotationErrorClamp:.01,translationConvergeThreshold:1e-5,rotationConvergeThreshold:1e-5};let m,f,g,y,v,b,S,x,C,_,E=!0;const M=new i.Vector3;let I,T,L,P,R,k,O;!function(){f=new d.default,document.body.appendChild(f.dom),g=document.getElementById("output"),y=new i.WebGLRenderer({antialias:!0}),y.setPixelRatio(window.devicePixelRatio),y.setSize(window.innerWidth,window.innerHeight),y.shadowMap.enabled=!0,y.shadowMap.type=i.PCFSoftShadowMap,y.outputEncoding=i.sRGBEncoding,document.body.appendChild(y.domElement),b=new i.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,100),b.position.set(.3,.3,.3),v=new i.Scene,v.background=new i.Color(1971741),_=new i.DirectionalLight,_.position.set(1,3,2),_.intensity=.75,_.castShadow=!0,_.shadow.mapSize.setScalar(2048);const e=_.shadow.camera;e.top=e.right=.25,e.left=e.bottom=-.25,e.near=0,e.far=10,e.updateProjectionMatrix();const t=new i.DirectionalLight;t.intensity=.25,t.position.set(-1,-3,-2);const o=new i.AmbientLight(2038302,1);v.add(_,_.target,t,o),S=new a.OrbitControls(b,y.domElement),S.target.y=.05,S.update(),x=new s.TransformControls(b,y.domElement),x.setSpace("local"),v.add(x),x.addEventListener("mouseDown",(()=>{S.enabled=!1,h.animate="none"})),x.addEventListener("mouseUp",(()=>{S.enabled=!0,E=!0,l.setIKFromUrdf(T,I),T.updateMatrixWorld(!0)})),C=new i.Group,v.add(C),x.attach(C),x.addEventListener("objectChange",(()=>{E=!0})),m=new r.GUI,m.add(h,"enableControls"),m.add(h,"animate",["none","gyrate","rotate"]).listen(),m.add(h,"baseTilt",-.3,.3,1e-4).onChange((()=>E=!0)),m.add(h,"solve"),m.add(h,"displayMesh"),m.add(h,"displayIk"),m.add(h,"displayConvergedOnly"),m.add(h,"settleIterations",1,20,1).onChange((()=>E=!0));const n=new p.default;n.fetchOptions={mode:"cors"},n.packages={pi_hexapod_description:"https://raw.githubusercontent.com/PI-PhysikInstrumente/PI_ROS_Driver/master/pi_hexapod_driver/pi_hexapod_description/"},n.loadMeshCb=(e,t,o)=>{/\.stl$/.test(e)?new c.STLLoader(t).load(e,(e=>{const t=new i.Mesh(e);t.castShadow=!0,t.receiveShadow=!0,o(t)})):/\.dae$/.test(e)&&new w.ColladaLoader(t).load(e,(e=>{const t=e.scene,n=[];t.traverse((e=>{e.castShadow=!0,e.receiveShadow=!0,e.isLight&&n.push(e)})),n.forEach((e=>{e.parent.remove(e)})),o(t)}))},n.loadAsync("https://raw.githubusercontent.com/gkjohnson/PI_ROS_Driver/master/pi_hexapod_driver/pi_hexapod_description/urdf/pi_hexapod.urdf").then((e=>{I=e,I.traverse((e=>{"floating"===e.jointType&&(e.jointType="fixed")}));const t=I.joints;for(const e in t){const o=t[e];o.name.includes("ang")?(o.limit.lower=-1/0,o.limit.upper=1/0):o.name.includes("cart")?(o.limit.lower*=5,o.limit.upper*=5):"revolute"===o.jointType&&(o.jointType="continuous")}T=l.urdfRobotToIKRoot(I),T.setDoF(),I.rotation.set(-Math.PI/2,0,0),T.setEuler(-Math.PI/2,0,0);for(let e=0;e<6;e++){const t=`axis${e}_platform_anchor_joint_x`;I.joints[t].setJointValue(Math.PI)}l.setIKFromUrdf(T,I),k=T.find((e=>"platform_link"===e.name)),O=new l.Goal,O.setEuler(-Math.PI/2,0,0),O.setPosition(0,.095,0),O.makeClosure(k),C.quaternion.set(...O.quaternion),C.position.set(...O.position);for(let e=0;e<6;e++){const t=`axis${e}_base_anchor_link_3`,o=T.find((e=>e.name===t)),n=new l.Joint;n.setDoF(l.DOF.Z),n.setMinLimits(.035),n.setMaxLimits(.08),o.addChild(n);const i=new l.Link;n.addChild(i);const a=new l.Goal;a.setPosition(0,0,.05),a.setEuler(Math.PI,0,0),i.addChild(a);const s=`axis${e}_platform_anchor_link_3`,r=T.find((e=>e.name===s));a.makeClosure(r)}L=new l.IKRootsHelper([T,O]),L.setResolution(window.innerWidth,window.innerHeight),L.color.set(15277667).convertSRGBToLinear(),L.setColor(L.color),L.setJointScale(.05),P=new l.IKRootsHelper([T,O]),P.setResolution(window.innerWidth,window.innerHeight),P.color.set(15277667).convertSRGBToLinear(),P.setColor(P.color),P.setDrawThrough(!0),P.setJointScale(.05),R=new l.Solver([T,O]),v.add(I,L,P),v.add(I)})),window.addEventListener("resize",(()=>{const e=window.innerWidth,t=window.innerHeight,o=e/t;y.setSize(e,t),b.aspect=o,b.updateProjectionMatrix(),L&&(L.setResolution(window.innerWidth,window.innerHeight),P.setResolution(window.innerWidth,window.innerHeight))})),window.addEventListener("keydown",(e=>{switch(e.key){case"w":x.setMode("translate");break;case"e":x.setMode("rotate");break;case"q":x.setSpace("local"===x.space?"world":"local");break;case"f":S.target.set(0,.05,0),S.update()}}))}(),function e(){if(requestAnimationFrame(e),T&&!x.dragging){C.matrix.set(...k.matrixWorld).transpose(),C.matrix.decompose(C.position,C.quaternion,C.scale);const e=C.position,t=C.quaternion;O.setPosition(e.x,e.y,e.z),O.setQuaternion(t.x,t.y,t.z,t.w)}if(I){if(T.setEuler(-Math.PI/2,0,h.baseTilt),"gyrate"===h.animate){const e=.004*window.performance.now();C.position.z=.02*Math.cos(e),C.position.x=.02*Math.sin(e),C.position.y=.1025,C.rotation.set(-Math.PI/2,0,0),E=!0}else if("rotate"===h.animate){const e=.004*window.performance.now();C.position.set(0,.105+.0075*Math.sin(e),0),C.rotation.set(-Math.PI/2,0,.75*Math.cos(1*e)),E=!0}E&&h.solve&&(!function(){O.setPosition(C.position.x,C.position.y,C.position.z),O.setQuaternion(C.quaternion.x,C.quaternion.y,C.quaternion.z,C.quaternion.w);let e="",t=0;l.setIKFromUrdf(T,I);let o=!1;for(let n=0;n<h.settleIterations;n++){T.updateMatrixWorld(!0),Object.assign(R,u);const n=window.performance.now(),i=R.solve(),a=window.performance.now()-n;t+=a,e+=a.toFixed(2)+"ms "+l.SOLVE_STATUS_NAMES[i[0]]+"\n",o=i.filter((e=>e===l.SOLVE_STATUS.CONVERGED)).length===i.length;const s=i.filter((e=>e===l.SOLVE_STATUS.DIVERGED)).length===i.length,r=i.filter((e=>e===l.SOLVE_STATUS.STALLED)).length===i.length;if(o||s||r)break}e=e+"\nTotal: "+t.toFixed(2)+"ms",g.textContent=e,(!h.displayConvergedOnly||o)&&l.setUrdfFromIK(I,T)}(),E=!1),I.visible=h.displayMesh,L.visible=h.displayIk,P.visible=h.displayIk,M.subVectors(_.position,_.target.position),_.target.position.copy(I.position),_.position.copy(I.position).add(M)}x.visible=h.enableControls,x.enabled=h.enableControls,y.render(v,b),f.update()}();
//# sourceMappingURL=hexapod.3979ddfd.js.map
